---
title: https加密通信原理
---

HTTPS（Hyper Text Transfer Protocol Secure）之所以安全，核心在于它在 HTTP 和 TCP 之间加了一层 **SSL/TLS 协议**。

简单来说，HTTP 是“裸奔”的（明文传输），任何中间人（路由器、运营商、黑客）都能看到并修改内容；而 HTTPS 则是给数据加了一个“保险柜”（加密传输）。

HTTPS 保证安全主要依赖三个机制：**非对称加密**（用于身份验证和密钥协商）、**对称加密**（用于传输数据）、**数字证书**（防止身份伪造）。

下面为你梳理全流程，主要分为 **TLS 握手阶段**（建立安全连接）和 **数据传输阶段**。

---

### 一、 核心概念铺垫（为什么需要这么复杂？）

1.  **对称加密**（速度快，但密钥难给）：只有一把钥匙，加密解密用同一个。
    *   *痛点：* 怎么把这把钥匙安全地发给对方？直接发会被拦截。
2.  **非对称加密**（安全，但速度慢）：有公钥（给大家）和私钥（自己留）。公钥加密的数据，只有私钥能解。
    *   *作用：* 用来安全地协商那个“对称密钥”。
3.  **CA 证书**（身份证）：防止“中间人攻击”。如果没有证书，黑客可以冒充服务器给你发他的公钥。

---

### 二、 HTTPS 全流程详解

假设你（Client）要访问百度（Server）：

#### 第一阶段：TLS 四次握手（建立信任与协商密钥）

这个阶段的目标是：**在不安全的网络中，安全地商量出一个“会话密钥”**。

1.  **Client Hello（打招呼）**
    *   浏览器向服务器发送请求。
    *   **携带信息：** 支持的 TLS 版本（如 TLS 1.2/1.3）、支持的加密套件列表、还有一个**随机数 A (Client Random)**。

2.  **Server Hello（回应与出示证件）**
    *   服务器收到请求后进行确认。
    *   **携带信息：** 确认使用的加密算法、生成一个**随机数 B (Server Random)**。
    *   **关键动作：** 服务器把自己的 **数字证书** 发给浏览器（证书里包含了服务器的**公钥**）。

3.  **Client 验证证书（查户口）**
    *   浏览器收到证书后，不会马上信，而是去系统内置的“受信任的根证书颁发机构（CA）”列表里比对。
    *   **验证内容：** 证书是否过期？颁发机构是否合法？证书上的域名和我要访问的域名是否一致？
    *   *如果验证失败：* 浏览器会爆红警告“连接不安全”。
    *   *如果验证成功：* 浏览器确认对方是真百度，且拿到了合法的**服务器公钥**。

4.  **密钥交换（生成核心机密）**
    *   浏览器生成一个新的随机数，叫 **预主密钥 (Pre-Master Secret)**。
    *   **加密：** 浏览器用刚才拿到的**服务器公钥**，把这个预主密钥加密，发给服务器。
    *   *此时：* 全世界只有服务器有私钥能解开这个包，中间人截获了也解不开。

5.  **生成会话密钥（Session Key）**
    *   现在，客户端和服务器手里都有了三个数：**随机数 A**、**随机数 B**、**预主密钥**。
    *   双方使用相同的算法，利用这三个数生成最终的 **会话密钥 (Session Key)**。
    *   *注：* 之后的通信，就全靠这个 Session Key 进行**对称加密**。

6.  **Finished（验证测试）**
    *   Client 发送一条用 Session Key 加密的消息：“握手结束，刚才发的数据你解密试试？”
    *   Server 也发送一条用 Session Key 加密的消息：“我也结束了，你的我也解开了。”
    *   双方验证无误，通道建立成功。

---

#### 第二阶段：数据传输（加密通信）

握手完成后，后续所有的 HTTP 请求（HTML、图片、密码提交等）都进入此阶段：

1.  **加密：** 发送方使用 **会话密钥** 对数据进行对称加密。
2.  **完整性校验：** 同时会对数据生成一个摘要（MAC），防止数据在传输途中被篡改（如被运营商插入广告）。
3.  **传输：** 密文在网络上传输。
4.  **解密：** 接收方使用 **会话密钥** 解密，并校验摘要，得到原始内容。

---

### 三、 总结：HTTPS 如何解决三大安全问题？

| 安全风险 | HTTPS 的解决方案 | 原理 |
| :--- | :--- | :--- |
| **窃听风险** (数据被看) | **加密传输** | 握手后使用**对称加密**（AES等），黑客截获了也是乱码。 |
| **篡改风险** (数据被改) | **数据一致性** | 每一份数据都附带**MAC（消息认证码）**，一旦被改，校验就会失败。 |
| **冒充风险** (钓鱼网站) | **身份验证** | 使用 **CA 数字证书**。只有拥有私钥的真服务器才能建立连接，防止被中间人攻击。 |

### 补充知识点（进阶）
*   **TLS 1.3 的优化：** 上述流程主要基于 TLS 1.2。最新的 TLS 1.3 更加激进，将握手过程缩短了一半（1-RTT），甚至支持 0-RTT（再次访问时直接发数据），速度更快且更安全（废弃了不安全的加密算法）。
*   **前向安全性 (PFS)：** 现代 HTTPS 倾向于使用 ECDHE 算法交换密钥。即使将来服务器的长期私钥被破解，黑客也无法解密之前的历史聊天记录，因为每次会话的密钥都是临时生成的。
